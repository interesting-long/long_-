C251 COMPILER V5.60.0,  main                                                               08/11/25  14:24:46  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\out_file\main.obj
COMPILER INVOKED BY: D:\keil\C251\BIN\C251.EXE ..\user\main.c LARGE NOALIAS FLOAT64 WARNINGLEVEL(3) OPTIMIZE(3,SIZE) BRO
                    -WSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\zf_driver;.
                    -.\user;..\code) DEBUG PRINT(.\out_file\main.lst) OBJECT(.\out_file\main.obj) 

stmt  level    source

    1          #include "zf_common_headfile.h"
    2          int T=0;
    3          int delta_Speed=0;
    4          
    5          int T4=0;
    6          unsigned char speed_update_flag=0;
    7          
    8          int current_delta_angle=0;
    9          float delta_angle_buffer=0;
   10          long int encoder=0;
   11          void pit_handler1 (void);
   12          //void pit_handler2 (void);
   13          void main()
   14          {
   15   1              clock_init(SYSTEM_CLOCK_40M);                           // 务必保留
   16   1              debug_init();                                                           // 务必保留
   17   1              /****************************************************/
   18   1              init_all();
   19   1              tim1_irq_handler = pit_handler1;// 设置定时器0中断回调函数
   20   1      //      tim2_irq_handler = pit_handler2;// 设置定时器1中断回调函数
   21   1          while(1)
   22   1              {
   23   2                      
   24   2                      switch(CAR_Mode)
   25   2                      {
   26   3                              case STOP:
   27   3                              {
   28   4                                      GO_Function();
   29   4                                      if(Key)
   30   4                                      {
   31   5                                              EA=0;
   32   5                                              menu_handle_key(Key);
   33   5                                              Key=0;
   34   5                                              EA=1;
   35   5                                      }
   36   4                                      if(Guan_Dao_Show_Item<Max_Item && Intial>5)
   37   4                                      {
   38   5                                              printf("Item:%d,All_road_Data:%ld,All_angle_Data:%f\n",Guan_Dao_Show_Item,All_road_Data[Guan_Dao_Sho
             -w_Item],All_angle_Data[Guan_Dao_Show_Item]);
   39   5                                              Guan_Dao_Show_Item++;
   40   5                                      }
   41   4                                      break;
   42   4                              }
   43   3                              case GO:
   44   3                              {
   45   4                                      GO_Function();
   46   4                                      break;
   47   4                              }
   48   3                              case GO_Pararm1: 
   49   3                              {
   50   4                                      GO_Function();
   51   4                                      break;
   52   4                              }
   53   3                              case GO_Pararm2: 
   54   3                              {
   55   4                                      GO_Function();
   56   4                                      break;
C251 COMPILER V5.60.0,  main                                                               08/11/25  14:24:46  PAGE 2   

   57   4                              }
   58   3                              case GO_Pararm3: 
   59   3                              {
   60   4                                      GO_Function();
   61   4                                      break;
   62   4                              }
   63   3                              case TEST_PWM: 
   64   3                              {
   65   4                                      GO_Function();
   66   4                                      PWM_Test();
   67   4                                      break;
   68   4                              }
   69   3                              case TEST_SERVO: 
   70   3                              {
   71   4                                      GO_Function();
   72   4                                      Serve_Test();
   73   4                                      break;
   74   4                              }
   75   3                              case ADC_Show:
   76   3                              {
   77   4                                      GO_Function();
   78   4                                      break;
   79   4                              }
   80   3                              case Seta_Servo:
   81   3                              {
   82   4                                      GO_Function();
   83   4                                      Set_Sevo();
   84   4                                      break;
   85   4                              }
   86   3                      }
   87   2                      if(Protect_flag)
   88   2                      {
   89   3                              Protect_flag=0;
   90   3                              CAR_Mode=STOP;
   91   3                              Turn_mode_Init();
   92   3                              
   93   3                      }
   94   2      
   95   2                      
   96   2         }
   97   1      }
   98          
   99          
  100          void pit_handler1(void)
  101          {
  102   1              T++;
  103   1              ADC_SampleAndFilter();//ADC采样
  104   1              Last_dajiao=dajiao;
  105   1              dajiao=Servo_turn_pid(unification());//转向值计算
  106   1              speed_control_ring();//读取编码器
  107   1              
  108   1              if_Cycle();//环岛检测
  109   1              if(Servo_Flag)//舵机控制
  110   1              {
  111   2                      Servo_Control();
  112   2              }
  113   1              if(GO_PID_Control+GO_PID_Control1+GO_PID_Control2+GO_PID_Control3==1)
  114   1              {
  115   2                      
  116   2                      Speed_diff((float)(dajiao)/100,0.1);
  117   2                      if(Intial>5)
  118   2                      {
  119   3                              imu963ra_get_gyro();
  120   3                              delta_angle=imu963ra_gyro_transition(imu963ra_gyro_y)/200+0.000079;
  121   3                              angle+=delta_angle;
  122   3                              Inertial_Navigation(IN_Val);//
C251 COMPILER V5.60.0,  main                                                               08/11/25  14:24:46  PAGE 3   

  123   3                              Speed_Control();
  124   3                      }
  125   2                      
  126   2      //              if(Intial<5 &&Intial>-5)
  127   2      //              {
  128   2      ////                    printf("%f\n",angle);
  129   2      ////                    printf("%ld\n",encoder);
  130   2      //              }
  131   2      
  132   2                      else if(Intial<-5)
  133   2                      {
  134   3                              imu963ra_get_gyro();
  135   3                              delta_angle=imu963ra_gyro_transition(imu963ra_gyro_y)/200+0.000079;
  136   3                              angle+=delta_angle;
  137   3                              Half_State_of_road(IN_Val);
  138   3                              
  139   3                      }
  140   2                      else if(Speed_Mode>5)
  141   2                      {
  142   3                              State_of_road();
  143   3                      }
  144   2                      else
  145   2                      {
  146   3                              Speed_Control();
  147   3                      }
  148   2              }
  149   1              if(T>=4)
  150   1              {
  151   2                      T=0;
  152   2                      if(Protect_Flag_Cycle)
  153   2                      {
  154   3                              Protect();
  155   3                      }
  156   2                      if(Key_Flag)//按键检测
  157   2                      {
  158   3                              Key_scaner();
  159   3                      }
  160   2                      if(ADC_Show_Flag)//ADC显示
  161   2                      {
  162   3                              Show_pararm();
  163   3                      }
  164   2              }
  165   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       840     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =        17     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        99     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
