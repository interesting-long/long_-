C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE zf_device_oled
OBJECT MODULE PLACED IN .\out_file\zf_device_oled.obj
COMPILER INVOKED BY: D:\keil\C251\BIN\C251.EXE ..\code\zf_device_oled.c LARGE NOALIAS FLOAT64 WARNINGLEVEL(3) OPTIMIZE(3
                    -,SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\z
                    -f_driver;..\user;..\code) DEBUG PRINT(.\out_file\zf_device_oled.lst) OBJECT(.\out_file\zf_device_oled.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2          * TC264 Opensourec Library ¼´£¨TC264 ¿ªÔ´¿â£©ÊÇÒ»¸ö»ùÓÚ¹Ù·½ SDK ½Ó¿ÚµÄµÚÈý·½¿ªÔ´¿â
    3          * Copyright (c) 2022 SEEKFREE Öð·É¿Æ¼¼
    4          *
    5          * ±¾ÎÄ¼þÊÇ TC264 ¿ªÔ´¿âµÄÒ»²¿·Ö
    6          *
    7          * TC264 ¿ªÔ´¿â ÊÇÃâ·ÑÈí¼þ
    8          * Äú¿ÉÒÔ¸ù¾Ý×ÔÓÉÈí¼þ»ù½ð»á·¢²¼µÄ GPL£¨GNU General Public License£¬¼´ GNUÍ¨ÓÃ¹«¹²Ðí¿ÉÖ¤£©µÄÌõ¿î
    9          * ¼´ GPL µÄµÚ3°æ£¨¼´ GPL3.0£©»ò£¨ÄúÑ¡ÔñµÄ£©ÈÎºÎºóÀ´µÄ°æ±¾£¬ÖØÐÂ·¢²¼ºÍ/»òÐÞ¸ÄËü
   10          *
   11          * ±¾¿ªÔ´¿âµÄ·¢²¼ÊÇÏ£ÍûËüÄÜ·¢»Ó×÷ÓÃ£¬µ«²¢Î´¶ÔÆä×÷ÈÎºÎµÄ±£Ö¤
   12          * ÉõÖÁÃ»ÓÐÒþº¬µÄÊÊÏúÐÔ»òÊÊºÏÌØ¶¨ÓÃÍ¾µÄ±£Ö¤
   13          * ¸ü¶àÏ¸½ÚÇë²Î¼û GPL
   14          *
   15          * ÄúÓ¦¸ÃÔÚÊÕµ½±¾¿ªÔ´¿âµÄÍ¬Ê±ÊÕµ½Ò»·Ý GPL µÄ¸±±¾
   16          * Èç¹ûÃ»ÓÐ£¬Çë²ÎÔÄ<https://www.gnu.org/licenses/>
   17          *
   18          * ¶îÍâ×¢Ã÷£º
   19          * ±¾¿ªÔ´¿âÊ¹ÓÃ GPL3.0 ¿ªÔ´Ðí¿ÉÖ¤Ð­Òé ÒÔÉÏÐí¿ÉÉêÃ÷ÎªÒëÎÄ°æ±¾
   20          * Ðí¿ÉÉêÃ÷Ó¢ÎÄ°æÔÚ libraries/doc ÎÄ¼þ¼ÐÏÂµÄ GPL3_permission_statement.txt ÎÄ¼þÖÐ
   21          * Ðí¿ÉÖ¤¸±±¾ÔÚ libraries ÎÄ¼þ¼ÐÏÂ ¼´¸ÃÎÄ¼þ¼ÐÏÂµÄ LICENSE ÎÄ¼þ
   22          * »¶Ó­¸÷Î»Ê¹ÓÃ²¢´«²¥±¾³ÌÐò µ«ÐÞ¸ÄÄÚÈÝÊ±±ØÐë±£ÁôÖð·É¿Æ¼¼µÄ°æÈ¨ÉùÃ÷£¨¼´±¾ÉùÃ÷£©
   23          *
   24          * ÎÄ¼þÃû³Æ          zf_device_oled
   25          * ¹«Ë¾Ãû³Æ          ³É¶¼Öð·É¿Æ¼¼ÓÐÏÞ¹«Ë¾
   26          * °æ±¾ÐÅÏ¢          ²é¿´ libraries/doc ÎÄ¼þ¼ÐÄÚ version ÎÄ¼þ °æ±¾ËµÃ÷
   27          * ¿ª·¢»·¾³          ADS v1.10.2
   28          * ÊÊÓÃÆ½Ì¨          TC264D
   29          * µêÆÌÁ´½Ó          https://seekfree.taobao.com/
   30          *
   31          * ÐÞ¸Ä¼ÇÂ¼
   32          * ÈÕÆÚ              ×÷Õß                ±¸×¢
   33          * 2022-09-15       pudding            first version
   34          * 2023-04-28       pudding            Ôö¼ÓÖÐÎÄ×¢ÊÍËµÃ÷
   35          *********************************************************************************************************
             -***********/
   36          /********************************************************************************************************
             -*************
   37          * ½ÓÏß¶¨Òå£º
   38          *                  ------------------------------------
   39          *                  Ä£¿é¹Ü½Å             µ¥Æ¬»ú¹Ü½Å
   40          *                  D0                 ²é¿´ zf_device_oled.h ÖÐ OLED_D0_PIN ºê¶¨Òå
   41          *                  D1                 ²é¿´ zf_device_oled.h ÖÐ OLED_D1_PIN ºê¶¨Òå
   42          *                  RES                ²é¿´ zf_device_oled.h ÖÐ OLED_RES_PIN ºê¶¨Òå
   43          *                  DC                 ²é¿´ zf_device_oled.h ÖÐ OLED_DC_PIN ºê¶¨Òå
   44          *                  CS                 ²é¿´ zf_device_oled.h ÖÐ OLED_CS_PIN ºê¶¨Òå
   45          *                  VCC                3.3VµçÔ´
   46          *                  GND                µçÔ´µØ
   47          *                  ------------------------------------
   48          *********************************************************************************************************
             -***********/
   49          
   50          #include "zf_common_debug.h"
   51          #include "zf_common_font.h"
   52          #include "zf_common_function.h"
   53          #include "zf_driver_delay.h"
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 2   

   54          #include "zf_driver_soft_spi.h"
   55          #include "zf_driver_spi.h"
   56          #include "zf_device_oled.h"
   57          
   58          #if OLED_USE_SOFT_SPI
               static soft_spi_info_struct             oled_spi;
               #define oled_spi_write_8bit(data)       (soft_spi_write_8bit(&oled_spi, (data)))
               #else
   62          #define oled_spi_write_8bit(data)       (spi_write_8bit(OLED_SPI, (data)))
   63          #endif
   64          
   65          static oled_dir_enum        oled_display_dir    = OLED_DEFAULT_DISPLAY_DIR;     // ÏÔÊ¾·½Ïò
   66          static oled_font_size_enum  oled_display_font   = OLED_DEFAULT_DISPLAY_FONT;    // ÏÔÊ¾×ÖÌåÀàÐÍ
   67          
   68          //-------------------------------------------------------------------------------------------------------
             -------------
   69          // º¯Êý¼ò½é     Ð´8Î»Êý¾Ý
   70          // ²ÎÊýËµÃ÷     data            Êý¾Ý
   71          // ·µ»Ø²ÎÊý     void
   72          // Ê¹ÓÃÊ¾Àý     oled_write_data(color);
   73          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ ÓÃ»§ÎÞÐè¹ØÐÄ
   74          //-------------------------------------------------------------------------------------------------------
             -------------
   75          static void oled_write_data (const uint8 data)
*** ERROR C25 IN LINE 75 OF ..\code\zf_device_oled.c: syntax error near ')'
   76          {
   77   1          OLED_DC(1);
   78   1          oled_spi_write_8bit(data);
*** ERROR C25 IN LINE 78 OF ..\code\zf_device_oled.c: syntax error near 'data'
*** ERROR C25 IN LINE 78 OF ..\code\zf_device_oled.c: syntax error near ')'
   79   1      }
   80   1      
   81   1      //-------------------------------------------------------------------------------------------------------
             -------------
   82   1      // º¯Êý¼ò½é     Ð´ÃüÁî
   83   1      // ²ÎÊýËµÃ÷     cmd             ÃüÁî
   84   1      // ·µ»Ø²ÎÊý     void
   85   1      // Ê¹ÓÃÊ¾Àý     oled_write_command(0xb0 + y);
   86   1      // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ ÓÃ»§ÎÞÐè¹ØÐÄ
   87   1      //-------------------------------------------------------------------------------------------------------
             -------------
   88   1      static void oled_write_command (const uint8 command)
*** WARNING C194 IN LINE 88 OF ..\code\zf_device_oled.c: obsolete declaration: use '<type> data  command'
   89   1      {
   90   2          OLED_DC(0);
   91   2          oled_spi_write_8bit(command);
   92   2      }
   93   1      
   94   1      //-------------------------------------------------------------------------------------------------------
             -------------
   95   1      // º¯Êý¼ò½é     OLEDÏÔÊ¾×ø±êÉèÖÃ
   96   1      // ²ÎÊýËµÃ÷     x               xÖá×ø±êÉèÖÃ0-127
   97   1      // ²ÎÊýËµÃ÷     y               yÖá×ø±êÉèÖÃ0-7
   98   1      // ·µ»Ø²ÎÊý     void
   99   1      // Ê¹ÓÃÊ¾Àý     oled_set_coordinate(x, y);
  100   1      // ±¸×¢ÐÅÏ¢     ÄÚ²¿Ê¹ÓÃÓÃ»§ÎÞÐè¹ØÐÄ
  101   1      //-------------------------------------------------------------------------------------------------------
             -------------
  102   1      static void oled_set_coordinate (uint8 x, uint8 y)
  103   1      {
  104   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  105   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  106   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  107   2          zf_assert(128 > x);
  108   2          zf_assert(8 > y);
  109   2      
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 3   

  110   2          oled_write_command(0xb0 + y);
*** WARNING C188 IN LINE 110 OF ..\code\zf_device_oled.c: 'parameter 1': value truncated
  111   2          oled_write_command(((x & 0xf0) >> 4) | 0x10);
  112   2          oled_write_command((x & 0x0f) | 0x00);
  113   2      }
  114   1      
  115   1      //-------------------------------------------------------------------------------------------------------
             -------------
  116   1      // º¯Êý¼ò½é     OLEDÏÔÊ¾DEBUGÐÅÏ¢³õÊ¼»¯
  117   1      // ²ÎÊýËµÃ÷     void
  118   1      // ·µ»Ø²ÎÊý     void
  119   1      // Ê¹ÓÃÊ¾Àý     oled_debug_init();
  120   1      // ±¸×¢ÐÅÏ¢     ÄÚ²¿Ê¹ÓÃÓÃ»§ÎÞÐè¹ØÐÄ
  121   1      //-------------------------------------------------------------------------------------------------------
             -------------
  122   1      static void oled_debug_init (void)
  123   1      {
  124   2          debug_output_struct info;
*** ERROR C67 IN LINE 124 OF ..\code\zf_device_oled.c: 'debug_output_struct': undefined identifier
*** ERROR C25 IN LINE 124 OF ..\code\zf_device_oled.c: syntax error near 'info'
*** WARNING C34 IN LINE 124 OF ..\code\zf_device_oled.c: 'info': missing declaration specifiers
  125   2          debug_output_struct_init(&info);
*** ERROR C25 IN LINE 125 OF ..\code\zf_device_oled.c: syntax error near '&'
  126   2      
  127   2          info.type_index = 1;
*** ERROR C25 IN LINE 127 OF ..\code\zf_device_oled.c: syntax error near '.'
  128   2      
  129   2          info.display_x_max = OLED_X_MAX;
*** ERROR C25 IN LINE 129 OF ..\code\zf_device_oled.c: syntax error near '.'
  130   2          info.display_y_max = OLED_Y_MAX;
*** ERROR C25 IN LINE 130 OF ..\code\zf_device_oled.c: syntax error near '.'
  131   2          switch(oled_display_font)
*** ERROR C25 IN LINE 131 OF ..\code\zf_device_oled.c: syntax error near 'switch'
  132   2          {
*** ERROR C103 IN LINE 132 OF ..\code\zf_device_oled.c: 'oled_display_font': illegal function definition (missing ';' ?)
  133   2              case OLED_6X8_FONT:
  134   2              {
  135   2                  info.font_x_size = 6;
  136   2                  info.font_y_size = 1;
  137   2              }break;
  138   2              case OLED_8X16_FONT:
  139   2              {
  140   2                  info.font_x_size = 8;
  141   2                  info.font_y_size = 2;
  142   2              }break;
  143   2              case OLED_16X16_FONT:
  144   2              {
  145   2                  // ÔÝ²»Ö§³Ö
  146   2              }break;
  147   2          }
  148   2          info.output_screen = oled_show_string;
  149   2          info.output_screen_clear = oled_clear;
  150   2      
  151   2          debug_output_init(&info);
  152   2      }
  153   2      
  154   2      //-------------------------------------------------------------------------------------------------------
             -------------
  155   2      // º¯Êý¼ò½é     OLED ÇåÆÁº¯Êý
  156   2      // ²ÎÊýËµÃ÷     void
  157   2      // ·µ»Ø²ÎÊý     void
  158   2      // Ê¹ÓÃÊ¾Àý     oled_clear();
  159   2      // ±¸×¢ÐÅÏ¢
  160   2      //-------------------------------------------------------------------------------------------------------
             -------------
  161   2      void oled_clear (void)
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 4   

  162   2      {
  163   2          uint8 y = 0, x = 0;
  164   2      
  165   2          OLED_CS(0);
  166   2          for(y = 0; 8 > y; y ++)
  167   2          {
  168   2              oled_write_command(0xb0 + y);
  169   2              oled_write_command(0x01);
  170   2              oled_write_command(0x10);
  171   2              for(x = 0; OLED_X_MAX > x; x ++)
  172   2              {
  173   2                  oled_write_data(0x00);
  174   2              }
  175   2          }
  176   2          OLED_CS(1);
  177   2      }
  178   2      
  179   2      //-------------------------------------------------------------------------------------------------------
             -------------
  180   2      // º¯Êý¼ò½é     OLED ÆÁÄ»Ìî³äº¯Êý
  181   2      // ²ÎÊýËµÃ÷     color           Ìî³äÑÕÉ«Ñ¡×Å(0x00 or 0xff)
  182   2      // ·µ»Ø²ÎÊý     void
  183   2      // Ê¹ÓÃÊ¾Àý     oled_full(0x00);
  184   2      // ±¸×¢ÐÅÏ¢
  185   2      //-------------------------------------------------------------------------------------------------------
             -------------
  186   2      void oled_full (const uint8 color)
  187   2      {
  188   2          uint8 y = 0, x = 0;
  189   2      
  190   2          OLED_CS(0);
  191   2          for(y = 0; 8 > y; y ++)
  192   2          {
  193   2              oled_write_command(0xb0 + y);
  194   2              oled_write_command(0x01);
  195   2              oled_write_command(0x10);
  196   2              for(x = 0; OLED_X_MAX > x; x ++)
  197   2              {
  198   2                  oled_write_data(color);
  199   2              }
  200   2          }
  201   2          OLED_CS(1);
  202   2      }
  203   2      
  204   2      //-------------------------------------------------------------------------------------------------------
             -------------
  205   2      // º¯Êý¼ò½é     ÉèÖÃÏÔÊ¾·½Ïò
  206   2      // ²ÎÊýËµÃ÷     dir             ÏÔÊ¾·½Ïò  ²ÎÕÕ zf_device_oled.h ÄÚ oled_dir_enum Ã¶¾ÙÌå¶¨Òå
  207   2      // ·µ»Ø²ÎÊý     void
  208   2      // Ê¹ÓÃÊ¾Àý     oled_set_dir(OLED_CROSSWISE);
  209   2      // ±¸×¢ÐÅÏ¢     Õâ¸öº¯ÊýÖ»ÓÐÔÚ³õÊ¼»¯ÆÁÄ»Ö®Ç°µ÷ÓÃ²ÅÉúÐ§
  210   2      //-------------------------------------------------------------------------------------------------------
             -------------
  211   2      void oled_set_dir (oled_dir_enum dir)
  212   2      {
  213   2          oled_display_dir = dir;
  214   2      }
  215   2      
  216   2      //-------------------------------------------------------------------------------------------------------
             -------------
  217   2      // º¯Êý¼ò½é     ÉèÖÃÏÔÊ¾×ÖÌå
  218   2      // ²ÎÊýËµÃ÷     dir             ÏÔÊ¾·½Ïò  ²ÎÕÕ zf_device_oled.h ÄÚ oled_font_size_enum Ã¶¾ÙÌå¶¨Òå
  219   2      // ·µ»Ø²ÎÊý     void
  220   2      // Ê¹ÓÃÊ¾Àý     oled_set_font(OLED_8x16_FONT);
  221   2      // ±¸×¢ÐÅÏ¢     ×ÖÌå¿ÉÒÔËæÊ±×ÔÓÉÉèÖÃ ÉèÖÃºóÉúÐ§ ºóÐøÏÔÊ¾¾ÍÊÇÐÂµÄ×ÖÌå´óÐ¡
  222   2      //-------------------------------------------------------------------------------------------------------
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 5   

             -------------
  223   2      void oled_set_font (oled_font_size_enum font)
  224   2      {
  225   2          oled_display_font = font;
  226   2      }
  227   2      
  228   2      //-------------------------------------------------------------------------------------------------------
             -------------
  229   2      // º¯Êý¼ò½é     »­µãº¯Êý
  230   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  231   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  232   2      // ²ÎÊýËµÃ÷     color           8 ¸öµãÊý¾Ý
  233   2      // ·µ»Ø²ÎÊý     void
  234   2      // Ê¹ÓÃÊ¾Àý     oled_draw_point(0, 0, 1);
  235   2      // ±¸×¢ÐÅÏ¢
  236   2      //-------------------------------------------------------------------------------------------------------
             -------------
  237   2      void oled_draw_point (uint16 x, uint16 y, const uint8 color)
  238   2      {
  239   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  240   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  241   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  242   2          zf_assert(x < 128);
  243   2          zf_assert(y < 8);
  244   2      
  245   2          OLED_CS(0);
  246   2          oled_set_coordinate((uint8)x, (uint8)y);
  247   2          oled_write_command(0xb0 + y);
  248   2          oled_write_command(((x & 0xf0) >> 4) | 0x10);
  249   2          oled_write_command((x & 0x0f) | 0x00);
  250   2          oled_write_data(color);
  251   2          OLED_CS(1);
  252   2      }
  253   2      
  254   2      //-------------------------------------------------------------------------------------------------------
             -------------
  255   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾×Ö·û´®
  256   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  257   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  258   2      // ²ÎÊýËµÃ÷     ch[]            ×Ö·û´®
  259   2      // ·µ»Ø²ÎÊý     void
  260   2      // Ê¹ÓÃÊ¾Àý     oled_show_string(0, 0, "SEEKFREE");
  261   2      // ±¸×¢ÐÅÏ¢
  262   2      //-------------------------------------------------------------------------------------------------------
             -------------
  263   2      void oled_show_string (uint16 x, uint16 y, const char ch[])
  264   2      {
  265   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  266   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  267   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  268   2          zf_assert(128 > x);
  269   2          zf_assert(8 > y);
  270   2      
  271   2          OLED_CS(0);
  272   2          uint8 c = 0, i = 0, j = 0;
  273   2          while ('\0' != ch[j])
  274   2          {
  275   2              switch(oled_display_font)
  276   2              {
  277   2                  case OLED_6X8_FONT:
  278   2                  {
  279   2                      c = ch[j] - 32;
  280   2                      if(x > 126)
  281   2                      {
  282   2                          x = 0;
  283   2                          y ++;
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 6   

  284   2                      }
  285   2                      oled_set_coordinate((uint8)x, (uint8)y);
  286   2                      for(i = 0; 6 > i; i ++)
  287   2                      {
  288   2                          oled_write_data(ascii_font_6x8[c][i]);
  289   2                      }
  290   2                      x += 6;
  291   2                      j ++;
  292   2                  }break;
  293   2                  case OLED_8X16_FONT:
  294   2                  {
  295   2                      c = ch[j] - 32;
  296   2                      if(x > 120)
  297   2                      {
  298   2                          x = 0;
  299   2                          y ++;
  300   2                      }
  301   2                      oled_set_coordinate((uint8)x, (uint8)y);
  302   2                      for(i = 0; 8 > i; i ++)
  303   2                      {
  304   2                          oled_write_data(ascii_font_8x16[c][i]);
  305   2                      }
  306   2      
  307   2                      oled_set_coordinate((uint8)x, (uint8)(y + 1));
  308   2                      for(i = 0; 8 > i; i ++)
  309   2                      {
  310   2                          oled_write_data(ascii_font_8x16[c][i + 8]);
  311   2                      }
  312   2                      x += 8;
  313   2                      j ++;
  314   2                  }break;
  315   2                  case OLED_16X16_FONT:
  316   2                  {
  317   2                      // ÔÝ²»Ö§³Ö
  318   2                  }break;
  319   2              }
  320   2          }
  321   2          OLED_CS(1);
  322   2      }
  323   2      
  324   2      //-------------------------------------------------------------------------------------------------------
             -------------
  325   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾32Î»ÓÐ·ûºÅ (È¥³ýÕûÊý²¿·ÖÎÞÐ§µÄ0)
  326   2      // ²ÎÊýËµÃ÷     x               xÖá×ø±êÉèÖÃ 0-127
  327   2      // ²ÎÊýËµÃ÷     y               yÖá×ø±êÉèÖÃ 0-7
  328   2      // ²ÎÊýËµÃ÷     dat             ÐèÒªÏÔÊ¾µÄ±äÁ¿ Êý¾ÝÀàÐÍ int32
  329   2      // ²ÎÊýËµÃ÷     num             ÐèÒªÏÔÊ¾µÄÎ»Êý ×î¸ß10Î»  ²»°üº¬Õý¸ººÅ
  330   2      // ·µ»Ø²ÎÊý     void
  331   2      // Ê¹ÓÃÊ¾Àý     oled_show_int(0, 0, x, 3);                      // x ¿ÉÒÔÎª int32 int16 int8 ÀàÐÍ
  332   2      // ±¸×¢ÐÅÏ¢     ¸ºÊý»áÏÔÊ¾Ò»¸ö ¡®-¡¯ºÅ   ÕýÊýÏÔÊ¾Ò»¸ö¿Õ¸ñ
  333   2      //-------------------------------------------------------------------------------------------------------
             -------------
  334   2      void oled_show_int (uint16 x, uint16 y, const int32 dat, uint8 num)
  335   2      {
  336   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  337   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  338   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  339   2          zf_assert(128 > x);
  340   2          zf_assert(8 > y);
  341   2      
  342   2          zf_assert(0 < num);
  343   2          zf_assert(10 >= num);
  344   2      
  345   2          int32 dat_temp = dat;
  346   2          int32 offset = 1;
  347   2          char data_buffer[12];
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 7   

  348   2      
  349   2          memset(data_buffer, 0, 12);
  350   2          memset(data_buffer, ' ', num + 1);
  351   2      
  352   2          // ÓÃÀ´¼ÆËãÓàÊýÏÔÊ¾ 123 ÏÔÊ¾ 2 Î»ÔòÓ¦¸ÃÏÔÊ¾ 23
  353   2          if(10 > num)
  354   2          {
  355   2              for(; 0 < num; num --)
  356   2              {
  357   2                  offset *= 10;
  358   2              }
  359   2              dat_temp %= offset;
  360   2          }
  361   2          func_int_to_str(data_buffer, dat_temp);
  362   2          oled_show_string(x, y, (const char *)&data_buffer);
  363   2      }
  364   2      
  365   2      //-------------------------------------------------------------------------------------------------------
             -------------
  366   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾32Î»ÎÞ·ûºÅ (È¥³ýÕûÊý²¿·ÖÎÞÐ§µÄ0)
  367   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  368   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  369   2      // ²ÎÊýËµÃ÷     dat             ÐèÒªÏÔÊ¾µÄ±äÁ¿ Êý¾ÝÀàÐÍ uint32
  370   2      // ²ÎÊýËµÃ÷     num             ÐèÒªÏÔÊ¾µÄÎ»Êý ×î¸ß10Î»  ²»°üº¬Õý¸ººÅ
  371   2      // ·µ»Ø²ÎÊý     void
  372   2      // Ê¹ÓÃÊ¾Àý     oled_show_uint(0, 0, x, 3);                     // x ¿ÉÒÔÎª uint32 uint16 uint8 ÀàÐÍ
  373   2      // ±¸×¢ÐÅÏ¢
  374   2      //-------------------------------------------------------------------------------------------------------
             -------------
  375   2      void oled_show_uint (uint16 x,uint16 y,const uint32 dat,uint8 num)
  376   2      {
  377   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  378   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  379   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  380   2          zf_assert(128 > x);
  381   2          zf_assert(8 > y);
  382   2      
  383   2          zf_assert(0 < num);
  384   2          zf_assert(10 >= num);
  385   2      
  386   2          uint32 dat_temp = dat;
  387   2          int32 offset = 1;
  388   2          char data_buffer[12];
  389   2          memset(data_buffer, 0, 12);
  390   2          memset(data_buffer, ' ', num);
  391   2      
  392   2          // ÓÃÀ´¼ÆËãÓàÊýÏÔÊ¾ 123 ÏÔÊ¾ 2 Î»ÔòÓ¦¸ÃÏÔÊ¾ 23
  393   2          if(10 > num)
  394   2          {
  395   2              for(; 0 < num; num --)
  396   2              {
  397   2                  offset *= 10;
  398   2              }
  399   2              dat_temp %= offset;
  400   2          }
  401   2          func_uint_to_str(data_buffer, dat_temp);
  402   2          oled_show_string(x, y, (const char *)&data_buffer);
  403   2      }
  404   2      
  405   2      //-------------------------------------------------------------------------------------------------------
             -------------
  406   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾¸¡µãÊý (È¥³ýÕûÊý²¿·ÖÎÞÐ§µÄ0)
  407   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  408   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  409   2      // ²ÎÊýËµÃ÷     dat             ÐèÒªÏÔÊ¾µÄ±äÁ¿ Êý¾ÝÀàÐÍ double
  410   2      // ²ÎÊýËµÃ÷     num             ÕûÊýÎ»ÏÔÊ¾³¤¶È   ×î¸ß8Î»  
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 8   

  411   2      // ²ÎÊýËµÃ÷     pointnum        Ð¡ÊýÎ»ÏÔÊ¾³¤¶È   ×î¸ß6Î»
  412   2      // ·µ»Ø²ÎÊý     void
  413   2      // Ê¹ÓÃÊ¾Àý     oled_show_float(0, 0, x, 2, 3);                 // ÏÔÊ¾¸¡µãÊý   ÕûÊýÏÔÊ¾2Î»   Ð¡ÊýÏÔÊ¾ÈýÎ
             -»
  414   2      // ±¸×¢ÐÅÏ¢     ÌØ±ð×¢Òâµ±·¢ÏÖÐ¡Êý²¿·ÖÏÔÊ¾µÄÖµÓëÄãÐ´ÈëµÄÖµ²»Ò»ÑùµÄÊ±ºò£¬
  415   2      //              ¿ÉÄÜÊÇÓÉÓÚ¸¡µãÊý¾«¶È¶ªÊ§ÎÊÌâµ¼ÖÂµÄ£¬Õâ²¢²»ÊÇÏÔÊ¾º¯ÊýµÄÎÊÌâ£¬
  416   2      //              ÓÐ¹ØÎÊÌâµÄÏêÇé£¬Çë×ÔÐÐ°Ù¶ÈÑ§Ï°   ¸¡µãÊý¾«¶È¶ªÊ§ÎÊÌâ¡£
  417   2      //              ¸ºÊý»áÏÔÊ¾Ò»¸ö ¡®-¡¯ºÅ   ÕýÊýÏÔÊ¾Ò»¸ö¿Õ¸ñ
  418   2      //-------------------------------------------------------------------------------------------------------
             -------------
  419   2      void oled_show_float (uint16 x,uint16 y,const double dat,uint8 num,uint8 pointnum)
  420   2      {
  421   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  422   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  423   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  424   2          zf_assert(128 > x);
  425   2          zf_assert(8 > y);
  426   2      
  427   2          zf_assert(0 < num);
  428   2          zf_assert(8 >= num);
  429   2          zf_assert(0 < pointnum);
  430   2          zf_assert(6 >= pointnum);
  431   2      
  432   2          double dat_temp = dat;
  433   2          double offset = 1.0;
  434   2          char data_buffer[17];
  435   2          memset(data_buffer, 0, 17);
  436   2          memset(data_buffer, ' ', num + pointnum + 2);
  437   2      
  438   2          // ÓÃÀ´¼ÆËãÓàÊýÏÔÊ¾ 123 ÏÔÊ¾ 2 Î»ÔòÓ¦¸ÃÏÔÊ¾ 23
  439   2          for(; 0 < num; num --)
  440   2          {
  441   2              offset *= 10;
  442   2          }
  443   2          dat_temp = dat_temp - ((int)dat_temp / (int)offset) * offset;
  444   2          func_double_to_str(data_buffer, dat_temp, pointnum);
  445   2          oled_show_string(x, y, data_buffer);
  446   2      }
  447   2      
  448   2      //-------------------------------------------------------------------------------------------------------
             -------------
  449   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾¶þÖµÍ¼Ïñ Êý¾ÝÃ¿°Ë¸öµã×é³ÉÒ»¸ö×Ö½ÚÊý¾Ý
  450   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  451   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  452   2      // ²ÎÊýËµÃ÷     *image          Í¼ÏñÊý×éÖ¸Õë
  453   2      // ²ÎÊýËµÃ÷     width           Í¼ÏñÊµ¼Ê¿í¶È
  454   2      // ²ÎÊýËµÃ÷     height          Í¼ÏñÊµ¼Ê¸ß¶È
  455   2      // ²ÎÊýËµÃ÷     dis_width       Í¼ÏñÏÔÊ¾¿í¶È ²ÎÊý·¶Î§ [0, 128]
  456   2      // ²ÎÊýËµÃ÷     dis_height      Í¼ÏñÏÔÊ¾¸ß¶È ²ÎÊý·¶Î§ [0, 64]
  457   2      // ·µ»Ø²ÎÊý     void
  458   2      // Ê¹ÓÃÊ¾Àý     oled_show_binary_image(0, 0, ov7725_image_binary[0], OV7725_W, OV7725_H, OV7725_W, OV7725
             -_H);
  459   2      // ±¸×¢ÐÅÏ¢     ÓÃÓÚÏÔÊ¾Ð¡×ê·çµÄÎ´½âÑ¹µÄÑ¹Ëõ¶þÖµ»¯Í¼Ïñ
  460   2      //              Õâ¸öº¯Êý²»¿ÉÒÔÓÃÀ´Ö±½ÓÏÔÊ¾×Ü×ê·çµÄÎ´Ñ¹ËõµÄ¶þÖµ»¯Í¼Ïñ
  461   2      //              Õâ¸öº¯Êý²»¿ÉÒÔÓÃÀ´Ö±½ÓÏÔÊ¾×Ü×ê·çµÄÎ´Ñ¹ËõµÄ¶þÖµ»¯Í¼Ïñ
  462   2      //              Õâ¸öº¯Êý²»¿ÉÒÔÓÃÀ´Ö±½ÓÏÔÊ¾×Ü×ê·çµÄÎ´Ñ¹ËõµÄ¶þÖµ»¯Í¼Ïñ
  463   2      //-------------------------------------------------------------------------------------------------------
             -------------
  464   2      void oled_show_binary_image (uint16 x, uint16 y, const uint8 *image, uint16 width, uint16 height, uint16 
             -dis_width, uint16 dis_height)
  465   2      {
  466   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  467   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  468   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  469   2          zf_assert(128 > x);
  470   2          zf_assert(8 > y);
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 9   

  471   2          zf_assert(NULL != image);
  472   2      
  473   2          uint32 i = 0, j = 0, z = 0;
  474   2          uint8 dat = 0;
  475   2          uint32 width_index = 0, height_index = 0;
  476   2      
  477   2          OLED_CS(0);
  478   2          dis_height = dis_height - dis_height % 8;
  479   2          dis_width = dis_width - dis_width % 8;
  480   2          for(j = 0; j < dis_height; j += 8)
  481   2          {
  482   2              oled_set_coordinate(x + 0, (uint16)(y + j / 8));
  483   2              height_index = j * height / dis_height;
  484   2              for(i = 0; i < dis_width; i += 8)
  485   2              {
  486   2                  width_index = i * width / dis_width / 8;
  487   2                  for(z = 0; 8 > z; z ++)
  488   2                  {
  489   2                      dat = 0;
  490   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 0) & (0x80 >> z))
  491   2                      {
  492   2                          dat |= 0x01;
  493   2                      }
  494   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 1) & (0x80 >> z))
  495   2                      {
  496   2                          dat |= 0x02;
  497   2                      }
  498   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 2) & (0x80 >> z))
  499   2                      {
  500   2                          dat |= 0x04;
  501   2                      }
  502   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 3) & (0x80 >> z))
  503   2                      {
  504   2                          dat |= 0x08;
  505   2                      }
  506   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 4) & (0x80 >> z))
  507   2                      {
  508   2                          dat |= 0x10;
  509   2                      }
  510   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 5) & (0x80 >> z))
  511   2                      {
  512   2                          dat |= 0x20;
  513   2                      }
  514   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 6) & (0x80 >> z))
  515   2                      {
  516   2                          dat |= 0x40;
  517   2                      }
  518   2                      if(*(image + height_index * width / 8 + width_index + width / 8 * 7) & (0x80 >> z))
  519   2                      {
  520   2                          dat |= 0x80;
  521   2                      }
  522   2                      oled_write_data(dat);
  523   2                  }
  524   2              }
  525   2          }
  526   2          OLED_CS(1);
  527   2      }
  528   2      
  529   2      //-------------------------------------------------------------------------------------------------------
             -------------
  530   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾ 8bit »Ò¶ÈÍ¼Ïñ ´ø¶þÖµ»¯ãÐÖµ
  531   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  532   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  533   2      // ²ÎÊýËµÃ÷     *image          Í¼ÏñÊý×éÖ¸Õë
  534   2      // ²ÎÊýËµÃ÷     width           Í¼ÏñÊµ¼Ê¿í¶È
  535   2      // ²ÎÊýËµÃ÷     height          Í¼ÏñÊµ¼Ê¸ß¶È
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 10  

  536   2      // ²ÎÊýËµÃ÷     dis_width       Í¼ÏñÏÔÊ¾¿í¶È ²ÎÊý·¶Î§ [0, 128]
  537   2      // ²ÎÊýËµÃ÷     dis_height      Í¼ÏñÏÔÊ¾¸ß¶È ²ÎÊý·¶Î§ [0, 64]
  538   2      // ²ÎÊýËµÃ÷     threshold       ¶þÖµ»¯ÏÔÊ¾ãÐÖµ 0-²»¿ªÆô¶þÖµ»¯
  539   2      // ·µ»Ø²ÎÊý     void
  540   2      // Ê¹ÓÃÊ¾Àý     oled_show_gray_image(0, 0, mt9v03x_image[0], width, height, 128, 64, x);
  541   2      // ±¸×¢ÐÅÏ¢     ÓÃÓÚÏÔÊ¾×Ü×ê·çµÄÍ¼Ïñ
  542   2      //              Èç¹ûÒªÏÔÊ¾¶þÖµ»¯Í¼Ïñ Ö±½ÓÐÞ¸Ä×îºóÒ»¸ö²ÎÊýÎªÐèÒªµÄ¶þÖµ»¯ãÐÖµ¼´¿É
  543   2      //              Èç¹ûÒªÏÔÊ¾¶þÖµ»¯Í¼Ïñ Ö±½ÓÐÞ¸Ä×îºóÒ»¸ö²ÎÊýÎªÐèÒªµÄ¶þÖµ»¯ãÐÖµ¼´¿É
  544   2      //              Èç¹ûÒªÏÔÊ¾¶þÖµ»¯Í¼Ïñ Ö±½ÓÐÞ¸Ä×îºóÒ»¸ö²ÎÊýÎªÐèÒªµÄ¶þÖµ»¯ãÐÖµ¼´¿É
  545   2      //-------------------------------------------------------------------------------------------------------
             -------------
  546   2      void oled_show_gray_image (uint16 x, uint16 y, const uint8 *image, uint16 width, uint16 height, uint16 di
             -s_width, uint16 dis_height, uint8 threshold)
  547   2      {
  548   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  549   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  550   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  551   2          zf_assert(128 > x);
  552   2          zf_assert(8 > y);
  553   2          zf_assert(NULL != image);
  554   2      
  555   2          int16 i = 0, j = 0;
  556   2          uint8 dat = 0;
  557   2          uint32 width_index = 0, height_index = 0;
  558   2      
  559   2          OLED_CS(0);
  560   2          dis_height = dis_height - dis_height % 8;
  561   2          for(j = 0; j < dis_height; j += 8)
  562   2          {
  563   2              oled_set_coordinate(x + 0, y + j / 8);
  564   2              height_index = j * height / dis_height;
  565   2              for(i = 0; i < dis_width; i ++)
  566   2              {
  567   2                  width_index = i * width / dis_width;
  568   2                  dat = 0;
  569   2                  if(*(image + height_index * width + width_index + width * 0) > threshold)
  570   2                  {
  571   2                      dat |= 0x01;
  572   2                  }
  573   2                  if(*(image + height_index * width + width_index + width * 1) > threshold)
  574   2                  {
  575   2                      dat |= 0x02;
  576   2                  }
  577   2                  if(*(image + height_index * width + width_index + width * 2) > threshold)
  578   2                  {
  579   2                      dat |= 0x04;
  580   2                  }
  581   2                  if(*(image + height_index * width + width_index + width * 3) > threshold)
  582   2                  {
  583   2                      dat |= 0x08;
  584   2                  }
  585   2                  if(*(image + height_index * width + width_index + width * 4) > threshold)
  586   2                  {
  587   2                      dat |= 0x10;
  588   2                  }
  589   2                  if(*(image + height_index * width + width_index + width * 5) > threshold)
  590   2                  {
  591   2                      dat |= 0x20;
  592   2                  }
  593   2                  if(*(image + height_index * width + width_index + width * 6) > threshold)
  594   2                  {
  595   2                      dat |= 0x40;
  596   2                  }
  597   2                  if(*(image + height_index * width + width_index + width * 7) > threshold)
  598   2                  {
  599   2                      dat |= 0x80;
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 11  

  600   2                  }
  601   2                  oled_write_data(dat);
  602   2              }
  603   2          }
  604   2          OLED_CS(1);
  605   2      }
  606   2      
  607   2      //-------------------------------------------------------------------------------------------------------
             -------------
  608   2      // º¯Êý¼ò½é     OLED ÏÔÊ¾²¨ÐÎ
  609   2      // ²ÎÊýËµÃ÷     x               x Öá×ø±êÉèÖÃ 0-127
  610   2      // ²ÎÊýËµÃ÷     y               y Öá×ø±êÉèÖÃ 0-7
  611   2      // ²ÎÊýËµÃ÷     *wave           ²¨ÐÎÊý×éÖ¸Õë
  612   2      // ²ÎÊýËµÃ÷     width           ²¨ÐÎÊµ¼Ê¿í¶È
  613   2      // ²ÎÊýËµÃ÷     value_max       ²¨ÐÎÊµ¼Ê×î´óÖµ
  614   2      // ²ÎÊýËµÃ÷     dis_width       ²¨ÐÎÏÔÊ¾¿í¶È ²ÎÊý·¶Î§ [0, 128]
  615   2      // ²ÎÊýËµÃ÷     dis_value_max   ²¨ÐÎÏÔÊ¾×î´óÖµ ²ÎÊý·¶Î§ [0, 64]
  616   2      // ·µ»Ø²ÎÊý     void
  617   2      // Ê¹ÓÃÊ¾Àý     oled_show_wave(0, 0, data, 128, 64, 128, 64);
  618   2      // ±¸×¢ÐÅÏ¢
  619   2      //-------------------------------------------------------------------------------------------------------
             -------------
  620   2      void oled_show_wave (uint16 x, uint16 y, const uint16 *wave, uint16 width, uint16 value_max, uint16 dis_w
             -idth, uint16 dis_value_max)
  621   2      {
  622   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  623   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  624   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  625   2          zf_assert(128 > x);
  626   2          zf_assert(8 > y);
  627   2          zf_assert(NULL != wave);
  628   2      
  629   2          uint32 i = 0;
  630   2          uint32 width_index = 0, value_max_index = 0;
  631   2          uint8 dis_h = 0;
  632   2      
  633   2          uint32 x_temp = 0;
  634   2          uint32 y_temp = 0;
  635   2      
  636   2          OLED_CS(0);
  637   2          for(y_temp = 0; y_temp < dis_value_max; y_temp += 8)
  638   2          {
  639   2              oled_set_coordinate(x + 0, (uint16)(y + y_temp / 8));
  640   2              for(x_temp = 0; x_temp < dis_width; x_temp ++)
  641   2              {
  642   2                  oled_write_data(0x00); 
  643   2              }
  644   2          }
  645   2          for(i = 0; i < dis_width; i ++)
  646   2          {
  647   2              width_index = i * width / dis_width;
  648   2              value_max_index = *(wave + width_index) * (dis_value_max - 1) / value_max;
  649   2      
  650   2              dis_h = (uint8)((dis_value_max - 1) - value_max_index);
  651   2              oled_set_coordinate((uint16)(i + x), dis_h / 8 + y);
  652   2              dis_h = (0x01 << dis_h % 8);
  653   2              oled_write_data(dis_h);
  654   2          }
  655   2          OLED_CS(1);
  656   2      }
  657   2      
  658   2      //-------------------------------------------------------------------------------------------------------
             -------------
  659   2      // º¯Êý¼ò½é     ºº×ÖÏÔÊ¾
  660   2      // ²ÎÊýËµÃ÷     x               ºá×ø±ê 0-127
  661   2      // ²ÎÊýËµÃ÷     y               ×Ý×ø±ê 0-7
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 12  

  662   2      // ²ÎÊýËµÃ÷     size            È¡Ä£µÄÊ±ºòÉèÖÃµÄºº×Ö×ÖÌå´óÐ¡£¬Ò²¾ÍÊÇÒ»¸öºº×ÖÕ¼ÓÃµÄµãÕó³¤¿íÎª¶àÉÙ¸öµã£¬È¡Ä
             -£µÄÊ±ºòÐèÒª³¤¿íÊÇÒ»ÑùµÄ¡£
  663   2      // ²ÎÊýËµÃ÷     *chinese_buffer ÐèÒªÏÔÊ¾µÄºº×ÖÊý×é
  664   2      // ²ÎÊýËµÃ÷     number          ÐèÒªÏÔÊ¾¶àÉÙÎ»
  665   2      // ·µ»Ø²ÎÊý     void
  666   2      // Ê¹ÓÃÊ¾Àý     oled_show_chinese(0, 6, 16, (const uint8 *)oled_16x16_chinese, 4);
  667   2      // ±¸×¢ÐÅÏ¢     Ê¹ÓÃPCtoLCD2002Èí¼þÈ¡Ä£       ÒõÂë¡¢ÖðÐÐÊ½¡¢Ë³Ïò       16*16
  668   2      //-------------------------------------------------------------------------------------------------------
             -------------
  669   2      void oled_show_chinese (uint16 x, uint16 y, uint8 size, const uint8 *chinese_buffer, uint8 number)
  670   2      {
  671   2          // Èç¹û³ÌÐòÔÚÊä³öÁË¶ÏÑÔÐÅÏ¢ ²¢ÇÒÌáÊ¾³ö´íÎ»ÖÃÔÚÕâÀï
  672   2          // ÄÇÃ´Ò»°ãÊÇÆÁÄ»ÏÔÊ¾µÄÊ±ºò³¬¹ýÆÁÄ»·Ö±æÂÊ·¶Î§ÁË
  673   2          // ¼ì²éÒ»ÏÂÄãµÄÏÔÊ¾µ÷ÓÃµÄº¯Êý ×Ô¼º¼ÆËãÒ»ÏÂÄÄÀï³¬¹ýÁËÆÁÄ»ÏÔÊ¾·¶Î§
  674   2          zf_assert(128 > x);
  675   2          zf_assert(8 > y);
  676   2          zf_assert(NULL != chinese_buffer);
  677   2      
  678   2          int16 i = 0, j = 0, k = 0;
  679   2      
  680   2          OLED_CS(0);
  681   2          for(i = 0; i < number; i ++)
  682   2          {
  683   2              for(j = 0; j < (size / 8); j ++)
  684   2              {
  685   2                  oled_set_coordinate(x + i * size, y + j);
  686   2                  for(k = 0; 16 > k; k ++)
  687   2                  {
  688   2                      oled_write_data(*chinese_buffer);
  689   2                      chinese_buffer ++;
  690   2                  }
  691   2              }
  692   2          }
  693   2          OLED_CS(1);
  694   2      }
  695   2      
  696   2      //-------------------------------------------------------------------------------------------------------
             -------------
  697   2      // º¯Êý¼ò½é     OLED³õÊ¼»¯º¯Êý
  698   2      // ²ÎÊýËµÃ÷     void
  699   2      // ·µ»Ø²ÎÊý     void
  700   2      // Ê¹ÓÃÊ¾Àý     oled_init();
  701   2      // ±¸×¢ÐÅÏ¢
  702   2      //-------------------------------------------------------------------------------------------------------
             -------------
  703   2      void oled_init (void)
  704   2      {
  705   2      #if OLED_USE_SOFT_SPI
                   soft_spi_init(&oled_spi, 0, OLED_SOFT_SPI_DELAY, OLED_D0_PIN, OLED_D1_PIN, SOFT_SPI_PIN_NULL, SOFT_SP
             -I_PIN_NULL);
               #else
  708   2          spi_init(OLED_SPI, SPI_MODE0, OLED_SPI_SPEED, OLED_D0_PIN, OLED_D1_PIN, OLED_D1_PIN_IN, SPI_CS_NULL);
  709   2      #endif
  710   2          gpio_init(OLED_RES_PIN, GPO, GPIO_HIGH, GPO_PUSH_PULL);
  711   2          gpio_init(OLED_DC_PIN , GPO, GPIO_HIGH, GPO_PUSH_PULL);
  712   2          gpio_init(OLED_CS_PIN , GPO, GPIO_HIGH, GPO_PUSH_PULL);
  713   2      
  714   2          oled_set_dir(oled_display_dir);
  715   2      
  716   2          OLED_CS(0);
  717   2          OLED_RES(0);
  718   2          system_delay_ms(50);
  719   2          OLED_RES(1);
  720   2      
  721   2          oled_write_command(0xae);                                                   // ¹Ø±ÕoledÃæ°å
  722   2          oled_write_command(0x00);                                                   // ÉèÖÃµÍÁÐµØÖ·
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 13  

  723   2          oled_write_command(0x10);                                                   // ÉèÖÃ¸ßÁÐµØÖ·
  724   2          oled_write_command(0x40);                                                                            
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                           // --set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
  725   2          oled_write_command(0x81);                                                   // ÉèÖÃ¶Ô±È¶È¿ØÖÆ¼Ä´æÆ÷
  726   2          oled_write_command(OLED_BRIGHTNESS);                                        // ÉèÖÃSEGÊä³öµçÁ÷ÁÁ¶È
  727   2      
  728   2          if(OLED_PORTAIT == oled_display_dir)
  729   2          {
  730   2              oled_write_command(0xa1);                                               // ÉèÖÃ SEG/ÁÐ Ó³Éä     0
             -xa0×óÓÒ·´ÖÃ 0xa1Õý³£
  731   2              oled_write_command(0xc8);                                               // ÉèÖÃ COM/ÐÐÉ¨Ãè·½Ïò   
             - 0xc0ÉÏÏÂ·´ÖÃ 0xc8Õý³£
  732   2          }
  733   2          else
  734   2          {
  735   2              oled_write_command(0xa0);                                               // ÉèÖÃ SEG/ÁÐ Ó³Éä     0
             -xa0×óÓÒ·´ÖÃ 0xa1Õý³£
  736   2              oled_write_command(0xc0);                                               // ÉèÖÃ COM/ÐÐÉ¨Ãè·½Ïò   
             - 0xc0ÉÏÏÂ·´ÖÃ 0xc8Õý³£
  737   2          }
  738   2      
  739   2          oled_write_command(0xa6);                                                   // ÉèÖÃÕý³£ÏÔÊ¾
  740   2          oled_write_command(0xa8);                                                   // ÉèÖÃ¸´ÓÃ±È(1 ~ 64)
  741   2          oled_write_command(0x3f);                                                   // 1/64 Õ¼±È
  742   2          oled_write_command(0xd3);                                                   // ÉèÖÃÏÔÊ¾Æ«ÒÆÒÆÎ»Ó³ÉäRA
             -M¼ÆÊýÆ÷£¨0x00~0x3F£©
  743   2          oled_write_command(0x00);                                                   // ²»Æ«ÒÆ
  744   2          oled_write_command(0xd5);                                                   // ÉèÖÃÏÔÊ¾Ê±ÖÓ·ÖÆµ±È/Õñµ
             -´Æ÷ÆµÂÊ
  745   2          oled_write_command(0x80);                                                   // ÉèÖÃ·Ö¸î±ÈÂÊ£¬ÉèÖÃÊ±ÖÓ
             -Îª100Ö¡/Ãë
  746   2          oled_write_command(0xd9);                                                   // Éè¶¨Ô¤³äÆÚ
  747   2          oled_write_command(0xf1);                                                   // ÉèÖÃÔ¤³äÎª15¸öÊ±ÖÓ£¬·Å
             -µçÎª1¸öÊ±ÖÓ
  748   2          oled_write_command(0xda);                                                   // ÉèÖÃcomÒý½ÅÓ²¼þÅäÖÃ
  749   2          oled_write_command(0x12);
  750   2          oled_write_command(0xdb);                                                   // ÉèÖÃ vcomh
  751   2          oled_write_command(0x40);                                                   // ÉèÖÃVCOMÈ¡ÏûÑ¡Ôñ¼¶±ð
  752   2          oled_write_command(0x20);                                                   // ÉèÖÃÒ³ÃæÑ°Ö·Ä£Ê½(0x00/
             -0x01/0x02)
  753   2          oled_write_command(0x02);                                                   //
  754   2          oled_write_command(0x8d);                                                   // ÉèÖÃ³äµç±ÃÆôÓÃ/½ûÓÃ
  755   2          oled_write_command(0x14);                                                   // ÉèÖÃ(0 x10)½ûÓÃ
  756   2          oled_write_command(0xa4);                                                   // ½ûÓÃÕû¸öÏÔÊ¾´ò¿ª(0xa4/
C251 COMPILER V5.60.0,  zf_device_oled                                                     09/09/25  18:26:21  PAGE 14  

             -0xa5)
  757   2          oled_write_command(0xa6);                                                   // ½ûÓÃ·´ÏòÏÔÊ¾(0xa6/a7)
  758   2          oled_write_command(0xaf);                                                   // ´ò¿ªoledÃæ°å
  759   2          OLED_CS(1);
  760   2      
  761   2          oled_clear();                                                               // ³õÊ¼ÇåÆÁ
  762   2          oled_set_coordinate(0, 0);                                                  // OLEDÏÔÊ¾×ø±êÉèÖÃ
  763   2          oled_debug_init();                                                          // OLEDÏÔÊ¾DEBUGÐÅÏ¢³õÊ¼»
             -¯
  764   2      }

C251 COMPILATION COMPLETE.  3 WARNING(S),  11 ERROR(S)
